# ç¬¬5ç« -3ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼ˆbandit/safetyï¼‰å®Ÿè£…

## ğŸ¯ ã“ã®ç« ã®ç›®æ¨™

**bandit**ã¨**safety**ã‚’æ´»ç”¨ã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è‡ªå‹•åŒ–ã‚’å®Ÿè£…ã—ã€ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’åŒæ™‚ã«å‘ä¸Šã•ã›ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºåˆæœŸæ®µéšã§ã®è„†å¼±æ€§æ¤œå‡ºã¨ç¶™ç¶šçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ã¯ã˜ã‚ã«ï¼šãªãœã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦ãªã®ã‹ï¼Ÿ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®ç¾å®Ÿ

#### 1. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®è„†å¼±æ€§**
```python
# å±é™ºãªã‚³ãƒ¼ãƒ‰ä¾‹ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
PASSWORD = "admin123"  # â† banditãŒæ¤œå‡º

# å±é™ºãªã‚³ãƒ¼ãƒ‰ä¾‹ï¼šSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
query = f"SELECT * FROM users WHERE name = '{user_input}'"  # â† banditãŒæ¤œå‡º
```

#### 2. **ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§**
```txt
# è„†å¼±æ€§ã®ã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¾‹
requests==2.18.0  # â† CVE-2018-18074 (æ—¢çŸ¥ã®è„†å¼±æ€§)
django==1.11.0    # â† è¤‡æ•°ã®é‡å¤§ãªè„†å¼±æ€§
```

#### 3. **ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢è¦–ç‚¹ã§ã®é‡è¦æ€§**
- **ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ã§çµŒé¨“ã•ã‚Œã‚‹å½±éŸ¿**ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ã€ãƒ‡ãƒ¼ã‚¿æ¼æ´©
- **æ—©æœŸç™ºè¦‹ã®é‡è¦æ€§**ï¼šæœ¬ç•ªç’°å¢ƒã§ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œã‚ˆã‚Šã€é–‹ç™ºæ®µéšã§ã®äºˆé˜²ãŒé¥ã‹ã«åŠ¹ç‡çš„
- **è‡ªå‹•åŒ–ã®ä¾¡å€¤**ï¼šäººçš„ãƒã‚§ãƒƒã‚¯ã®é™ç•Œã‚’è£œå®Œã™ã‚‹ç¶™ç¶šçš„ç›£è¦–

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã®ç†è§£ï¼šbanditã¨safetyã®å½¹å‰²

### banditï¼šé™çš„ã‚³ãƒ¼ãƒ‰è§£æãƒ„ãƒ¼ãƒ«

#### Whatï¼ˆä½•ã‚’ï¼‰
Pythonã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šå±é™ºãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã™ã‚‹ãƒ„ãƒ¼ãƒ«

#### Whyï¼ˆãªãœï¼‰
- **é–‹ç™ºè€…ã®è¦‹è½ã¨ã—é˜²æ­¢**ï¼šäººé–“ãŒè¦‹é€ƒã—ãŒã¡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã‚’è‡ªå‹•æ¤œå‡º
- **æ—©æœŸç™ºè¦‹**ï¼šã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã‚’ç™ºè¦‹
- **æ•™è‚²åŠ¹æœ**ï¼šã©ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå±é™ºã‹ã‚’å­¦ç¿’ã§ãã‚‹

#### Howï¼ˆã©ã®ã‚ˆã†ã«ï¼‰
```python
# æ¤œå‡ºã•ã‚Œã‚‹å±é™ºãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¾‹

# 1. ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸèªè¨¼æƒ…å ±
password = "secret123"  # B105: hardcoded_password_string

# 2. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒªã‚¹ã‚¯
query = "SELECT * FROM users WHERE id = " + user_id  # B608: hardcoded_sql_expressions

# 3. å®‰å…¨ã§ãªã„ä¹±æ•°ç”Ÿæˆ
import random
token = random.random()  # B311: random

# 4. å±é™ºãªé–¢æ•°ã®ä½¿ç”¨
eval(user_input)  # B307: eval

# 5. SSLè¨¼æ˜æ›¸æ¤œè¨¼ã®ç„¡åŠ¹åŒ–
requests.get(url, verify=False)  # B501: request_with_no_cert_validation
```

### safetyï¼šä¾å­˜é–¢ä¿‚è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«

#### Whatï¼ˆä½•ã‚’ï¼‰
requirements.txtã«è¨˜è¼‰ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ—¢çŸ¥è„†å¼±æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ„ãƒ¼ãƒ«

#### Whyï¼ˆãªãœï¼‰
- **ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³æ”»æ’ƒå¯¾ç­–**ï¼šä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµŒç”±ã§ã®æ”»æ’ƒã‚’é˜²ã
- **ç¶™ç¶šçš„ç›£è¦–**ï¼šæ–°ãŸã«ç™ºè¦‹ã•ã‚Œã‚‹è„†å¼±æ€§ã¸ã®å¯¾å¿œ
- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹**ï¼šä¼æ¥­ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–ã®éµå®ˆ

---

## ä¾å­˜é–¢ä¿‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®è©³ç´°ç†è§£

### ğŸ” ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ã¨ã¯ä½•ã‹ï¼Ÿ

#### å®šç¾©ã¨ç›®çš„
**ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯**ã¨ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½¿ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆä¾å­˜é–¢ä¿‚ï¼‰ã«æ—¢çŸ¥ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ãŒå­˜åœ¨ã—ãªã„ã‹ã‚’è‡ªå‹•çš„ã«æ¤œè¨¼ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã§ã™ã€‚

#### ãªãœé‡è¦ãªã®ã‹ï¼Ÿ

##### 1. **ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³æ”»æ’ƒã®ãƒªã‚¹ã‚¯**
```python
# ä¾‹ï¼šä¸€è¦‹å®‰å…¨ã«è¦‹ãˆã‚‹ã‚³ãƒ¼ãƒ‰
import requests  # â† ã“ã®requestsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«è„†å¼±æ€§ãŒã‚ã‚‹ã¨...

def get_user_data(user_id):
    response = requests.get(f"https://api.example.com/users/{user_id}")
    return response.json()  # â† ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒæ½œåœ¨
```

**å®Ÿéš›ã®è„…å¨ä¾‹**ï¼š
- **2021å¹´**: `ua-parser-js`ï¼ˆé€±5000ä¸‡ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰ãŒä¹—ã£å–ã‚‰ã‚Œã€ãƒãƒ«ã‚¦ã‚§ã‚¢é…å¸ƒ
- **2022å¹´**: `node-ipc`ã§ãƒ­ã‚·ã‚¢ãƒ»ãƒ™ãƒ©ãƒ«ãƒ¼ã‚·ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹æ©Ÿèƒ½ãŒè¿½åŠ 
- **ç¶™ç¶šçš„**: Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚‚é¡ä¼¼äº‹ä»¶ãŒå¤šç™º

##### 2. **é–“æ¥ä¾å­˜é–¢ä¿‚ã®è¤‡é›‘æ€§**
```txt
ã‚ãªãŸã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
â”œâ”€â”€ Django==5.2.1
â”‚   â”œâ”€â”€ asgiref>=3.8.1        # â† é–“æ¥ä¾å­˜é–¢ä¿‚
â”‚   â””â”€â”€ sqlparse>=0.3.1       # â† é–“æ¥ä¾å­˜é–¢ä¿‚  
â”œâ”€â”€ requests==2.32.3
â”‚   â”œâ”€â”€ certifi>=2017.4.17    # â† é–“æ¥ä¾å­˜é–¢ä¿‚
â”‚   â”œâ”€â”€ charset-normalizer<4,>=2
â”‚   â”œâ”€â”€ idna<4,>=2.5
â”‚   â””â”€â”€ urllib3<3,>=1.21.1    # â† è„†å¼±æ€§ã®ãƒªã‚¹ã‚¯é«˜
```
**å•é¡Œç‚¹**ï¼š 200å€‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚ã‚‹å ´åˆã€æ‰‹å‹•ãƒã‚§ãƒƒã‚¯ã¯ç¾å®Ÿçš„ã§ãªã„

##### 3. **ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢è¦–ç‚¹ã§ã®å½±éŸ¿**
- **æœ¬ç•ªç’°å¢ƒã§ã®éšœå®³**ï¼šè„†å¼±æ€§ã‚’çªã„ãŸæ”»æ’ƒã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
- **ãƒ‡ãƒ¼ã‚¿æ¼æ´©**ï¼šèªè¨¼æƒ…å ±ã‚„å€‹äººæƒ…å ±ã®æµå‡º
- **æ³•çš„ãƒªã‚¹ã‚¯**ï¼šGDPRã€å€‹äººæƒ…å ±ä¿è­·æ³•é•åã«ã‚ˆã‚‹ç½°é‡‘
- **ä¿¡é ¼å¤±å¢œ**ï¼šé¡§å®¢ã‚„å–å¼•å…ˆã‹ã‚‰ã®ä¿¡é ¼åº¦ä½ä¸‹

### ğŸ› ï¸ ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ã®æ¯”è¼ƒ

#### Safety vs pip-auditï¼šæ±ºå®šçš„ãªé•ã„

| é …ç›® | Safety | pip-audit |
|------|--------|-----------|
| **é–‹ç™ºå…ƒ** | pyup.ioï¼ˆå•†ç”¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ | Googleï¼ˆOSSï¼‰ |
| **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¦æ±‚** | **æœ‰æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¿…é ˆ**ï¼ˆ2024å¹´ã€œï¼‰ | **å®Œå…¨ç„¡æ–™** |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | PyUpç‹¬è‡ªDB | OSVï¼ˆOpen Source Vulnerabilitiesï¼‰ |
| **æ›´æ–°é »åº¦** | å•†ç”¨ãƒ¬ãƒ™ãƒ«ï¼ˆé«˜é »åº¦ï¼‰ | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ï¼ˆé©åº¦ï¼‰ |
| **å‡ºåŠ›å½¢å¼** | JSON, ãƒ†ã‚­ã‚¹ãƒˆ | JSON, SARIF, ãƒ†ã‚­ã‚¹ãƒˆ |
| **GitHubçµ±åˆ** | è¦è¨­å®š | **ãƒã‚¤ãƒ†ã‚£ãƒ–å¯¾å¿œ** |
| **CI/CDå°å…¥** | å›°é›£ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ï¼‰ | **ç°¡å˜** |

#### å®Ÿéš›ã®ä½¿ç”¨æ„Ÿæ¯”è¼ƒ

##### Safetyï¼ˆæ—§ç‰ˆ vs æ–°ç‰ˆï¼‰
```bash
# æ—§ç‰ˆï¼ˆã€œ2023å¹´ï¼‰- ä½¿ã„ã‚„ã™ã‹ã£ãŸ
$ safety check
# å³åº§ã«çµæœè¡¨ç¤º

# æ–°ç‰ˆï¼ˆ2024å¹´ã€œï¼‰- ç™»éŒ²ãŒå¿…è¦
$ safety scan
Please login or register Safety CLI (free forever) to scan...
(R)egister for a free account in 30 seconds, or (L)ogin...
```

##### pip-auditï¼ˆç¾åœ¨æ¨å¥¨ï¼‰
```bash
# ã‚·ãƒ³ãƒ—ãƒ«ã§å³åº§ã«å®Ÿè¡Œå¯èƒ½
$ pip-audit
Found 2 known vulnerabilities in 2 packages
Name   Version ID             Fix Versions
------ ------- -------------- -------------------
django 5.2.1   PYSEC-2025-47  4.2.22,5.1.10,5.2.2
pip    23.2.1  PYSEC-2023-228 23.3

# è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
$ pip-audit --format=json --output=audit-report.json
```

#### ãªãœpip-auditãŒå„ªä½ãªã®ã‹ï¼Ÿ

##### 1. **ä¼æ¥­ç’°å¢ƒã§ã®å®Ÿç”¨æ€§**
```yaml
# CI/CDã§ã®ä½¿ç”¨ä¾‹
- name: Security audit
  run: pip-audit  # â† ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šä¸è¦ï¼
```

##### 2. **é€æ˜æ€§ã®é«˜ã„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**
- **OSV Database**: GoogleãŒé‹å–¶ã™ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹è„†å¼±æ€§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **GitHub Security Advisory**: GitHubã®è„†å¼±æ€§æƒ…å ±ã¨é€£æº
- **NVDï¼ˆNational Vulnerability Databaseï¼‰**: ç±³å›½æ”¿åºœæ¨™æº–ã¨ã®æ•´åˆæ€§

##### 3. **é–‹ç™ºè€…ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹**
```bash
# pip-auditã¯èª¬æ˜ãŒè©³ç´°
$ pip-audit --desc
django 5.2.1: CVE-2024-xxxx - Django's authentication system allows...
Fixed in: 5.2.2
Recommendation: Upgrade to Django 5.2.2 immediately
```

### ğŸ”„ å®Ÿéš›ã®è„†å¼±æ€§å¯¾å¿œãƒ•ãƒ­ãƒ¼

#### Step 1: è„†å¼±æ€§ç™ºè¦‹
```bash
$ pip-audit
Found 1 known vulnerability in 1 package
Name   Version ID             Fix Versions
------ ------- -------------- -------------
django 5.2.1   PYSEC-2025-47  5.2.2
```

#### Step 2: å½±éŸ¿ç¯„å›²åˆ†æ
```bash
# ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒDjangoã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèª
$ grep -r "from django" .
$ grep -r "import django" .
```

#### Step 3: ä¿®æ­£ã¨ãƒ†ã‚¹ãƒˆ
```bash
# 1. requirements.txtæ›´æ–°
Django==5.2.2

# 2. ä¾å­˜é–¢ä¿‚æ›´æ–°
pip install -r requirements.txt

# 3. å†ãƒã‚§ãƒƒã‚¯
pip-audit  # â†’ No known vulnerabilities found

# 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest
```

#### Step 4: ç¶™ç¶šç›£è¦–è¨­å®š
```yaml
# GitHub Actionsã§ã®å®šæœŸãƒã‚§ãƒƒã‚¯
name: Weekly Security Scan
on:
  schedule:
    - cron: '0 9 * * 1'  # æ¯é€±æœˆæ›œæ—¥
jobs:
  security:
    runs-on: ubuntu-latest
    steps:
    - run: pip-audit --require-hashes --desc
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŠ•è³‡å¯¾åŠ¹æœã®è€ƒå¯Ÿ

### åˆæœŸã‚³ã‚¹ãƒˆ vs å°†æ¥ãƒªã‚¹ã‚¯

| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­– | åˆæœŸã‚³ã‚¹ãƒˆ | é˜²ã’ã‚‹ãƒªã‚¹ã‚¯ |
|------------------|------------|--------------|
| ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ | **1æ™‚é–“** | ãƒ‡ãƒ¼ã‚¿æ¼æ´©ï¼ˆæ•°åƒä¸‡å††ï¼‰ |
| è‡ªå‹•ç›£è¦–è¨­å®š | **2æ™‚é–“** | ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ï¼ˆæ•°ç™¾ä¸‡å††ï¼‰ |
| ãƒãƒ¼ãƒ æ•™è‚² | **1æ—¥** | ä¿¡é ¼å¤±å¢œï¼ˆè¨ˆã‚ŠçŸ¥ã‚Œãªã„ï¼‰ |

### ã‚¤ãƒ³ãƒ•ãƒ©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¨ã£ã¦ã®ä¾¡å€¤

1. **äºˆé˜²çš„ä¿å®ˆ**ï¼šéšœå®³å¯¾å¿œã‚ˆã‚Šäºˆé˜²ã®æ–¹ãŒåŠ¹ç‡çš„
2. **è‡ªå‹•åŒ–**ï¼šäººçš„ãƒã‚§ãƒƒã‚¯ã®é™ç•Œã‚’è£œå®Œ
3. **è¨¼è·¡ç®¡ç†**ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»æ™‚ã®è¨¼æ‹ 
4. **ãƒãƒ¼ãƒ å®‰å¿ƒæ„Ÿ**ï¼šã€Œå®‰å…¨ãªç’°å¢ƒã§é–‹ç™ºã—ã¦ã„ã‚‹ã€ã¨ã„ã†ç¢ºä¿¡

#### Howï¼ˆã©ã®ã‚ˆã†ã«ï¼‰

## å®Ÿè£…æ‰‹é †ï¼šæ®µéšçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

### Step 1: ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Ÿè£…

#### 1.1 banditã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰è§£æ

```bash
# åŸºæœ¬çš„ãªå®Ÿè¡Œ
bandit -r . -f json -o bandit-report.json

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ãŸå®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
bandit -r . -c .bandit
```

#### 1.2 banditè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

`.bandit`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼š

```ini
[bandit]
# é™¤å¤–ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
exclude_dirs = /tests,/venv,/.venv,/__pycache__,/.pytest_cache

# é™¤å¤–ã™ã‚‹ãƒ†ã‚¹ãƒˆIDï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
# skips = B101,B601

# ä¿¡é ¼åº¦ãƒ¬ãƒ™ãƒ«ï¼ˆLOW, MEDIUM, HIGHï¼‰
confidence = HIGH

# é‡è¦åº¦ãƒ¬ãƒ™ãƒ«ï¼ˆLOW, MEDIUM, HIGHï¼‰  
severity = MEDIUM

# ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼
format = json
output = bandit-report.json
```

#### 1.3 pip-auditã«ã‚ˆã‚‹ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ï¼‰

```bash
# åŸºæœ¬çš„ãªå®Ÿè¡Œ
pip-audit

# JSONå½¢å¼ã§ã®å‡ºåŠ›
pip-audit --format=json --output=audit-report.json

# è©³ç´°ãªèª¬æ˜ä»˜ãã§ã®å®Ÿè¡Œ
pip-audit --desc

# ç‰¹å®šã®è„†å¼±æ€§ã®ç„¡è¦–ï¼ˆä¸€æ™‚çš„ãªå¯¾å¿œï¼‰
pip-audit --ignore-vuln PYSEC-2023-228
```

**æ³¨æ„**: å¾“æ¥ã®safetyãƒ„ãƒ¼ãƒ«ã¯2024å¹´ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ãŒå¿…è¦ã«ãªã£ãŸãŸã‚ã€pip-auditã®ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### Step 2: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ±åˆ

#### 2.1 GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ›´æ–°

`.github/workflows/myWorkFlow.yml`ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ï¼š

```yaml
name: Enhanced Quality Pipeline with Security

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  PYTHON_VERSION: '3.11'

jobs:
  security-and-quality-check:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: Cache pip dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
    - name: Run bandit security scan
      run: |
        bandit -r . -f json -o bandit-report.json || true
        bandit -r . -f txt
        
    - name: Run pip-audit security scan
      run: |
        pip-audit --format=json --output=audit-report.json || true
        pip-audit --desc
        
    # æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆãƒ»å“è³ªãƒã‚§ãƒƒã‚¯
    - name: Run pytest with coverage
      run: |
        pytest --cov=. --cov-report=xml --cov-report=html --cov-report=term-missing
        
    - name: Run flake8
      run: |
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
        
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆä¿å­˜
    - name: Archive security reports
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: security-reports
        path: |
          bandit-report.json
          audit-report.json
          
    - name: Archive coverage reports
      uses: actions/upload-artifact@v3
      with:
        name: coverage-report
        path: htmlcov/
```

### Step 3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆã®è§£é‡ˆã¨å¯¾å¿œ

#### 3.1 banditãƒ¬ãƒãƒ¼ãƒˆã®èª­ã¿æ–¹

```json
{
  "errors": [],
  "generated_at": "2024-12-06T10:30:00Z",
  "metrics": {
    "_totals": {
      "CONFIDENCE.HIGH": 0,
      "CONFIDENCE.LOW": 1,
      "CONFIDENCE.MEDIUM": 2,
      "SEVERITY.HIGH": 0,
      "SEVERITY.LOW": 1,
      "SEVERITY.MEDIUM": 2,
      "loc": 150,
      "nosec": 0
    }
  },
  "results": [
    {
      "code": "password = 'hardcoded_password'",
      "filename": "./example.py",
      "issue_confidence": "HIGH",
      "issue_severity": "LOW", 
      "issue_text": "Possible hardcoded password: 'hardcoded_password'",
      "line_number": 23,
      "line_range": [23],
      "more_info": "https://bandit.readthedocs.io/en/latest/plugins/b105_hardcoded_password_string.html",
      "test_id": "B105",
      "test_name": "hardcoded_password_string"
    }
  ]
}
```

#### 3.2 å¯¾å¿œã®å„ªå…ˆé †ä½

| é‡è¦åº¦ | ä¿¡é ¼åº¦ | å¯¾å¿œæ–¹é‡ |
|--------|--------|----------|
| HIGH | HIGH | **å³åº§ã«ä¿®æ­£** |
| HIGH | MEDIUM | 24æ™‚é–“ä»¥å†…ã«ä¿®æ­£ |
| MEDIUM | HIGH | 1é€±é–“ä»¥å†…ã«ä¿®æ­£ |
| MEDIUM | MEDIUM | è¨ˆç”»çš„ã«ä¿®æ­£ |
| LOW | * | ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾Œåˆ¤æ–­ |

### Step 4: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã®ä¿®æ­£ä¾‹

#### 4.1 ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¿®æ­£

```python
# ä¿®æ­£å‰ï¼ˆå±é™ºï¼‰
DATABASE_PASSWORD = "secret123"

# ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰
import os
DATABASE_PASSWORD = os.environ.get('DATABASE_PASSWORD', '')

# ã¾ãŸã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨
from configparser import ConfigParser
config = ConfigParser()
config.read('config.ini')
DATABASE_PASSWORD = config.get('database', 'password')
```

#### 4.2 SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

```python
# ä¿®æ­£å‰ï¼ˆå±é™ºï¼‰
query = f"SELECT * FROM users WHERE name = '{username}'"

# ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰
query = "SELECT * FROM users WHERE name = %s"
cursor.execute(query, (username,))
```

#### 4.3 å®‰å…¨ã§ãªã„ä¹±æ•°ç”Ÿæˆã®ä¿®æ­£

```python
# ä¿®æ­£å‰ï¼ˆå±é™ºï¼‰
import random
token = str(random.randint(1000, 9999))

# ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰
import secrets
token = secrets.token_hex(16)
```

---

## ç¶™ç¶šçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†

### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç¢ºç«‹

```bash
# åˆå›å®Ÿè¡Œã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆ
bandit -r . -f json -o security-baseline.json
pip-audit --json --output safety-baseline.json

# ä»¥é™ã®å®Ÿè¡Œã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨æ¯”è¼ƒ
bandit -r . -b security-baseline.json
```

### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã®è‡ªå‹•åŒ–

```yaml
# é€±æ¬¡ã§ã®ä¾å­˜é–¢ä¿‚è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
name: Weekly Security Scan
on:
  schedule:
    - cron: '0 9 * * 1'  # æ¯é€±æœˆæ›œæ—¥ 9:00 AM
  
jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Run comprehensive security scan
      run: |
        pip install -r requirements.txt
        pip-audit --json --output safety-report.json
        bandit -r . -f txt
```

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾‹å¤–ç®¡ç†

```python
# ã‚„ã‚€ã‚’å¾—ãšã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’ç„¡è¦–ã™ã‚‹å ´åˆ
password = "test_password"  # nosec B105

# ã¾ãŸã¯.banditãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†
[bandit]
skips = B105  # ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã¿ï¼‰
```

---

## å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

### 1. **False Positiveã¸ã®å¯¾å¿œ**
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã¯æ™‚ã¨ã—ã¦èª¤æ¤œçŸ¥ã‚’èµ·ã“ã™
- å„è­¦å‘Šã‚’ç²¾æŸ»ã—ã€æœ¬å½“ã®ãƒªã‚¹ã‚¯ã‹ã‚’åˆ¤æ–­
- å¿…è¦ã«å¿œã˜ã¦ä¾‹å¤–è¨­å®šã‚’æ´»ç”¨

### 2. **é–‹ç™ºåŠ¹ç‡ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒãƒ©ãƒ³ã‚¹**
- éåº¦ã«å³æ ¼ãªè¨­å®šã¯é–‹ç™ºåŠ¹ç‡ã‚’é˜»å®³
- ãƒãƒ¼ãƒ åˆæ„ã®å…ƒã§ãƒ¬ãƒ™ãƒ«èª¿æ•´
- æ®µéšçš„ãªå³æ ¼åŒ–ã‚’æ¨å¥¨

### 3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ•™è‚²ã®é‡è¦æ€§**
- ãƒ„ãƒ¼ãƒ«ã®è­¦å‘Šç†ç”±ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦
- æ©Ÿæ¢°çš„ãªä¿®æ­£ã§ã¯ãªãã€æ ¹æœ¬çš„ãªç†è§£ã‚’ä¿ƒé€²

---

## ã¾ã¨ã‚

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®è‡ªå‹•åŒ–ã«ã‚ˆã‚Šä»¥ä¸‹ã‚’å®Ÿç¾ï¼š

### å³åº§ã®åŠ¹æœ
- **è„†å¼±æ€§ã®æ—©æœŸç™ºè¦‹**ï¼šé–‹ç™ºæ®µéšã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œæ¤œå‡º
- **ä¾å­˜é–¢ä¿‚ã®å®‰å…¨æ€§ç¢ºä¿**ï¼šæ—¢çŸ¥è„†å¼±æ€§ã®ã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç‰¹å®š
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ„è­˜ã®å‘ä¸Š**ï¼šé–‹ç™ºè€…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŸ¥è­˜å‘ä¸Š

### ç¶™ç¶šçš„ä¾¡å€¤
- **è‡ªå‹•åŒ–ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–**ï¼šç¶™ç¶šçš„ãªè„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œ**ï¼šä¼æ¥­ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–ã¸ã®æº–æ‹ 
- **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆäºˆé˜²**ï¼šæœ¬ç•ªç’°å¢ƒã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£äº‹æ•…ã®é˜²æ­¢

æ¬¡ç¯€ã€Œ05-4ï¼šã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆblackï¼‰è‡ªå‹•åŒ–ã€ã§ã¯ã€ã‚³ãƒ¼ãƒ‰å“è³ªã®ä¸€è²«æ€§ã‚’ç¢ºä¿ã™ã‚‹è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ 